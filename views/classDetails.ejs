<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Class Details</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous" />
  <style>
    body.bg-light {
      background: linear-gradient(to bottom right, #e3f2fd, #e8f5e9);
      font-family: "Segoe UI", Roboto, sans-serif;
      color: #333;
    }

    /* Heading */
    h2.text-primary {
      font-weight: 700;
      font-size: 2.4rem;
      margin-bottom: 1rem;
      position: relative;
    }

    h2.text-primary::after {
      content: '';
      width: 80px;
      height: 4px;
      background: #0d6efd;
      display: block;
      margin: 12px auto 0;
      border-radius: 5px;
    }

    /* Search form */
    form .form-control {
      border-radius: 50px;
      padding: 10px 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      border: 1px solid #ced4da;
      transition: 0.3s;
    }

    form .form-control:focus {
      border-color: #0d6efd;
      box-shadow: 0 0 5px rgba(13, 110, 253, 0.5);
    }

    form .btn-primary {
      border-radius: 50px;
      font-weight: 600;
      padding: 10px 0;
      transition: 0.3s;
    }

    /* Table */
    .table-container {
      background: #fff;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.05);
    }

    .table {
      margin-bottom: 0;
      border-radius: 10px;
      overflow: hidden;
    }

    .table th,
    .table td {
      vertical-align: middle;
      text-align: center;
      padding: 12px;
    }

    .table th {
      background: #0d6efd;
      color: #fff;
      font-weight: 600;
      font-size: 1rem;
    }

    .table tr:nth-child(even) {
      background-color: #f8f9fa;
    }

    .table-hover tbody tr:hover {
      background-color: #e3f2fd;
    }

    /* Buttons in actions */
    #edit-btn .btn,
    #delete-btn .btn,
    #details-btn .btn {
      border-radius: 30px;
      font-size: 0.85rem;
      padding: 6px 12px;
      transition: all 0.3s ease-in-out;
    }

    #edit-btn .btn:hover {
      background-color: #0d6efd;
      color: #fff;
    }

    #delete-btn .btn:hover {
      background-color: #dc3545;
      color: #fff;
      border-color: #dc3545;
    }

    #details-btn .btn:hover {
      background-color: #198754;
      color: #fff;
      border-color: #198754;
    }

    /* Total row */
    .table tbody .fw-bold {
      background: #e3f2fd;
      font-size: 1.05rem;
      font-weight: 600;
    }

    /* Back & Download Buttons */
    .custom-btn-outline,
    .custom-btn-success {
      font-weight: 600;
      border-radius: 30px;
      padding: 10px 20px;
      transition: 0.3s;
    }

    .custom-btn-outline {
      border: 2px solid #0d6efd;
      color: #0d6efd;
    }

    .custom-btn-outline:hover {
      background-color: #0d6efd;
      color: #fff;
    }

    .custom-btn-success {
      background-color: #28a745;
      color: white;
      border: none;
    }

    .custom-btn-success:hover {
      background-color: #218838;
    }

    /* Unauthorized section */
    .text-danger {
      font-size: 1.8rem;
      font-weight: bold;
    }

    .alert-warning {
      background-color: #fff3cd;
      color: #856404;
      border-radius: 10px;
      border: 1px solid #ffeeba;
    }
  </style>
</head>

<body class="bg-light">
  <% if (locals.user) { %>
    <%- include('navbar.ejs') %>
    <div class="container py-5">
      <h2 class="text-center mb-4 text-primary">Student Details - <%= students[0]?.studentClass  %> <% if(query?.stream){ %>
        <%= query?.stream %>
      <% }else{ %>
       <%  }%></h2>

      <form action="" method="get" class="mb-4">
        <div class="row g-2 justify-content-center">
          <div class="col-md-4">
            <input type="text" name="search" class="form-control" placeholder="Search student by name..."
              value="<%= query?.search || '' %>" />
          </div>
          <div class="col-md-2">
            <button type="submit" class="btn btn-primary w-100">Search</button>
          </div>
          <% if (query?.medium) { %>
            <input type="hidden" name="medium" value="<%= query.medium %>" />
            <% } %>
              <% if (query?.stream) { %>
                <input type="hidden" name="stream" value="<%= query.stream %>" />
                <% } %>
        </div>
      </form>

      <% if (students && students.length> 0) { %>
        <% let totalStudents=students.length; let totalFees=0; let totalPaid=0; students.forEach(student=> {
          totalFees += student.totalFees; totalPaid += student.feesPaid; }); let totalDue = totalFees - totalPaid; %>

          <div class="table-responsive table-container">
            <table class="table table-bordered table-striped table-hover">
              <thead class="text-center">
                <tr>
                  <th scope="col">S.No.</th>
                  <th scope="col">Name</th>
                  <th scope="col">Gender</th>
                  <th scope="col">Session</th>
                  <th scope="col">Contact No.</th>
                  <th scope="col">Registration No.</th>
                  <th scope="col">Medium</th>
                  <th scope="col">Total Fees</th>
                  <th scope="col">Fees Paid</th>
                  <th scope="col">Dues</th>
                  <th scope="col" colspan="3">Actions</th>
                </tr>
              </thead>
              <tbody>
                <% students.forEach((student, index)=> { %>
                  <tr>
                    <td class="text-center">
                      <%= index + 1 %>
                    </td>
                    <td class="text-center">
                      <%= student.studentName %>
                    </td>
                    <td class="text-center">
                      <%= student.gender %>
                    </td>
                    <td class="text-center">
                      <%= student.session %>
                    </td>
                    <td class="text-center">
                      <%= student.contactNo %>
                    </td>
                    <td class="text-center">
                      <%= student.registrationNo %>
                    </td>
                    <td class="text-center">
                      <%= student.medium %>
                    </td>
                    <td class="text-center">
                      <%= student.totalFees %>
                    </td>
                    <td class="text-center">
                      <%= student.feesPaid %>
                    </td>
                    <td class="text-center">
                      <%= student.totalFees - student.feesPaid %>
                    </td>
                    <td class="text-center" id="edit-btn"><a href="/students/edit/<%= student.registrationNo %>"
                        class="btn btn-outline-primary btn-sm">
                        Edit
                      </a></td>
                    <td class="text-center" id="delete-btn "><button class="btn"  onclick="return confirm('Are you sure you want to delete this student ?')"><a href="/students/delete/<%= student.registrationNo %>"
                        class="btn btn-outline-primary btn-sm"
                       >
                        Delete
                      </a></button></td>
                    <td class="text-center" id="details-btn"><a href="/students/details/<%= student.registrationNo %>"
                        class="btn btn-outline-primary btn-sm">
                        Details
                      </a></td>
                  </tr>
                  <% }) %>
                    <tr class="fw-bold bg-light text-center">
                      <td colspan="7">Total Students: <%= totalStudents %></td>
                      <td>
                        <%= totalFees %>
                      </td>
                      <td>
                        <%= totalPaid %>
                      </td>
                      <td>
                        <%= totalDue %>
                      </td>
                      <td colspan="3"></td>
                    </tr>
              </tbody>
            </table>
          </div>

          <% } else { %>
            <div class="alert alert-warning text-center">
              No students found for this class.
            </div>
            <% } %>
              <div class="text-center mt-4 d-flex justify-content-center gap-3">
                <a href="/students/allstudents" class="btn custom-btn-outline">
                  â¬… Back to All Classes
                </a>
                <% if (students && students.length> 0) { %>
                  <a href="/students/download-excel?studentClass=<%= students[0].studentClass %>&medium=<%= students[0].medium %><% if (students[0].studentClass === '11' || students[0].studentClass === '12') { %>&stream=<%= students[0].stream %><% } %>"
                    class="btn custom-btn-outline">
                    â¬‡ Download Data
                  </a>
                  <a href="/students/delete-multiple/<%= students[0].studentClass  %>/<%= students[0].medium %><% if(students[0].studentClass ==='11' || students[0].studentClass === '12'){%>/<%= students[0].stream  %><% } %>" class="btn custom-btn-outline">
  Delete Multiple Students
</a>
                  <% } %>
              </div>
    </div>
    <% } else { %>
      <div class="container d-flex justify-content-center align-items-center" style="height: 80vh">
        <div class="text-center">
          <h2 class="text-danger">
            ðŸš« You are not authorized to view this page.
          </h2>
          <a href="/login" class="btn btn-primary mt-3">Go to Login</a>
        </div>
      </div>
      <% } %>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
          crossorigin="anonymous"></script>
</body>

</html>