<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Student Fees Form</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
  <style>
    body {
      background-color: #f4f6f9;
    }

    .form-wrapper {
      max-width: 700px;
      margin: 50px auto;
      padding: 30px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.05);
    }

    h2 {
      font-weight: 600;
    }
  </style>
</head>

<body>

  <% if(user){ %>

    <%- include('navbar.ejs') %>
  <div class="container">
    <div class="form-wrapper">
      <h2 class="text-center text-success mb-4">üí≥ Student Fees Submission Form</h2>

      <p class="text-end text-muted mb-4">
  <strong>Date:</strong>
  <%= new Date().toLocaleDateString('en-IN', {
    day: '2-digit',
    month: 'long',
    year: 'numeric'
  }) %>
</p>


      <% if(errors && errors.length> 0){ %>
        <div class="alert alert-danger">
          <ul>
            <% errors.forEach(error=>{ %>
              <li>
                <%= error.msg %>
              </li>
              <% }) %>
          </ul>

        </div>
        <% } %>




          <form action="/students/studentFees" method="post">
            <div class="row g-3">
              

              <div class="col-md-6">
                <label for="studentName" class="form-label">Student's Name</label>
                <input type="text" class="form-control" id="studentName" name="studentName" required
                  pattern="[A-Za-z\s.\-']+"
                  title="Only letters, spaces, dots (.), hyphens (-), and apostrophes (') are allowed"
                  value="<%= formdata && formdata.studentName ? formdata.studentName : '' %>">
                <% if(errors && errors.length){ for(let i=0; i<errors.length; i++){ if(errors[i].param==='studentName'
                  ){ %>
                  <p style="color:red;">
                    <%= errors[i].msg %>
                  </p>
                  <% break; }} } %>
              </div>

              
              <div class="col-md-6">
                <label for="studentClass" class="form-label">Class</label>
                <select class="form-select" id="studentClass" name="studentClass" required>
                  <option value="">Select Class</option>
                  <option value="Nursery" <%= (formdata && formdata.studentClass === 'Nursery') ? 'selected' : ''
                    %>>Nursery</option>
                  <option value="LKG" <%= (formdata && formdata.studentClass === 'LKG') ? 'selected' : '' %>>LKG
                  </option>
                  <option value="UKG" <%= (formdata && formdata.studentClass === 'UKG') ? 'selected' : '' %>>UKG
                  </option>
                  <% for(let i = 1; i <= 10; i++) { %>
                    <option value="<%= i %>" <%= (formdata && formdata.studentClass== i) ? 'selected' : '' %>>
                      <%= i %>
                    </option>
                    <% } %>
                      <option value="11" <%= (formdata && formdata.studentClass== '11') ? 'selected' : '' %>>11
                      </option>
                      <option value="12" <%= (formdata && formdata.studentClass== '12') ? 'selected' : '' %>>12
                      </option>
                </select>
                <% if(errors && errors.length) { for(let i = 0; i<errors.length; i++){ if(errors[i].param ===
                  'studentClass'){ %>
                  <p style="color:red;">
                    <%= errors[i].msg %>
                  </p>
                  <% break; } }} %>
              </div>

              <div class="col-md-6">
                <label for="registrationNo" class="form-label">Registration Number</label>
                <input type="number" class="form-control" id="registrationNo" name="registrationNo" required
                  value="<%= formdata && formdata.registrationNo ? formdata.registrationNo : '' %>">
                <% if(errors && errors.length){ for(let i=0; i<errors.length; i++){
                  if(errors[i].param==='registrationNo' ){ %>
                  <p style="color:red;">
                    <%= errors[i].msg %>
                  </p>
                  <% break; }} } %>
              </div>

              <div class="col-md-6">
                <label for="amount" class="form-label">Amount (‚Çπ)</label>
                <input type="number" class="form-control" id="amount" name="amount" required
                  value="<%= formdata && formdata.amount ? formdata.amount : '' %>">
                <% if(errors && errors.length){ for(let i=0; i<errors.length; i++){ if(errors[i].param==='amount' ){ %>
                  <p style="color:red;">
                    <%= errors[i].msg %>
                  </p>
                  <% break; }} } %>
              </div>

              <div class="col-md-6">
                <label for="date" class="form-label">Date of Payment</label>
                <input type="date" class="form-control" id="date" name="date" required
                  value="<%= formdata && formdata.date ? formdata.date : '' %>">
                <% if(errors && errors.length){ for(let i=0; i<errors.length; i++){ if(errors[i].param==='date' ){ %>
                  <p style="color:red;">
                    <%= errors[i].msg %>
                  </p>
                  <% break; }} } %>
              </div>
              <div class="col-md-6">
                <label for="paymentMethod" class="form-label">Payment Method</label>
                <select class="form-select" id="paymentMethod" name="paymentMethod" required>
                  <option value="">-- Select Payment Method --</option>
                  <option value="Credit Card" <%=formdata && formdata.paymentMethod==='Credit Card' ? 'selected' : '' %>
                    >Credit Card</option>
                  <option value="UPI" <%=formdata && formdata.paymentMethod==='UPI' ? 'selected' : '' %>>UPI</option>
                  <option value="Cash" <%=formdata && formdata.paymentMethod==='Cash' ? 'selected' : '' %>>Cash</option>
                  <option value="Cheque" <%=formdata && formdata.paymentMethod==='Cheque' ? 'selected' : '' %>>Cheque
                  </option>
                </select>
                <% if(errors && errors.length){ for(let i=0; i < errors.length; i++){
                  if(errors[i].param==='paymentMethod' ){ %>
                  <p style="color:red;">
                    <%= errors[i].msg %>
                  </p>
                  <% break; }}} %>
              </div>

            </div>

            <div class="d-grid mt-4">
              <button type="submit" class="btn btn-success btn-lg">Submit Payment</button>
            </div>
          </form>
       <% if (submittedData && Object.keys(submittedData).length > 0) { %>
        
        <div class="card mt-5 shadow-lg border-success border-2 rounded-4" id="confirmationCard" style="background: linear-gradient(145deg, #e6ffe6, #ffffff);">
          <div class="card-body p-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h4 class="card-title text-success fw-bold">‚úÖ Payment Submitted</h4>
              <span class="text-muted small">
                <strong>Date:</strong>
                <%= new Date().toLocaleDateString('en-IN', {
                  day: '2-digit',
                  month: 'long',
                  year: 'numeric'
                }) %>
                </span>
                </div>
                
                <div class="mb-3">
                  <p><strong> <%= user.sName %></strong></p>
        <p><strong> Receipt No:</strong> <%= feesDetail?.receptNo || 'N/A' %></p>
        <p><strong> Student Name:</strong> <%= submittedData.studentName %></p>
        <p><strong> Class:</strong> <%= submittedData.studentClass %></p>
        <p><strong> Registration No:</strong> <%= submittedData.registrationNo %></p>
        <p><strong> Amount:</strong> ‚Çπ<%= submittedData.amount %></p>
        <p><strong> Date of Payment:</strong> <%= new Date(submittedData.date).toLocaleString('en-IN') %></p>
        <p><strong> Payment Method:</strong> <%= submittedData.paymentMethod %></p>
      </div>

      <div class="d-flex justify-content-end gap-3 mt-4 no-print">
  <button class="btn btn-success px-4" onclick="printCard()">üñ®Ô∏è Print</button>
  <button class="btn btn-danger px-4" onclick="document.getElementById('confirmationCard').remove();">‚ùå Cancel</button>
</div>

    </div>
  </div>
<% } %>


          <div class="text-center d-grid mt-4">
            <a href="/students/feeReceipt" class="btn btn-success btn-lg">Receipt</a>
          </div>
          <div class="text-center d-grid mt-4">
            <a href="/students/feeReceipt/daywise" class="btn btn-success btn-lg">Day Wise Transactions</a>
          </div>

          <div class="text-center d-grid mt-4">
            <a href="/" class="btn btn-success btn-lg">Back</a>
          </div>

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous">
    </script>
  <script>
    const studentNameInput = document.getElementById('studentName');

    // Block typing numbers
    studentNameInput.addEventListener('keypress', function (e) {
      if (/\d/.test(e.key)) {
        e.preventDefault();
      }
    });

    // Block pasting numbers
    studentNameInput.addEventListener('paste', function (e) {
      const pasted = (e.clipboardData || window.clipboardData).getData('text');
      if (/\d/.test(pasted)) {
        e.preventDefault();
      }
    });

    // Block dropping numbers
    studentNameInput.addEventListener('drop', function (e) {
      const dropped = e.dataTransfer.getData('text');
      if (/\d/.test(dropped)) {
        e.preventDefault();
      }
    });

    <!-- preview -->
   function printCard() {
    const printContent = document.getElementById('confirmationCard').outerHTML;
    const win = window.open('', 'Print-Window', 'height=700,width=900');

    win.document.write(`
      <html>
        <head>
          <title>Print Receipt</title>
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
          <style>
            body {
              margin: 20px;
              font-family: 'Segoe UI', sans-serif;
            }

            /* Hide elements with 'no-print' class in print view */
            @media print {
              .no-print {
                display: none !important;
              }
            }
          </style>
        </head>
        <body onload="window.print(); setTimeout(() => window.close(), 500);">
          <div class="container">
            ${printContent}
          </div>
        </body>
      </html>
    `);

    win.document.close();
  }

   if (window.history.replaceState) {
    window.history.replaceState(null, null, window.location.pathname);
  }
  </script>
<% } %>

</body>

</html>