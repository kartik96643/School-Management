<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Registration</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
  <style>
    body {
      background: linear-gradient(to right, #f8f9fa, #e3f2fd);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .container {
      max-width: 900px;
      margin: 50px auto;
      padding: 30px;
      background: #ffffff;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 123, 255, 0.1);
      animation: fadeIn 1s ease-in-out;
    }

    .form-container h2 {
      font-weight: 700;
      color: #0d6efd;
      font-size: 28px;

    }

    label.form-label {
      font-weight: 600;
      color: #333;
    }

    input.form-control,
    select.form-select {
      border-radius: 10px;
      border: 1px solid #ced4da;
      transition: all 0.3s ease;
    }

    input.form-control:focus,
    select.form-select:focus {
      border-color: #0d6efd;
      box-shadow: 0 0 5px rgba(13, 110, 253, 0.5);
    }

    .alert-danger {
      background-color: #f8d7da;
      border: none;
      border-left: 5px solid #dc3545;
      color: #721c24;
      padding: 10px 20px;
      border-radius: 10px;
      animation: slideIn 0.5s ease-in-out;
    }

    .btn-primary {
      background: linear-gradient(to right, #0d6efd, #6610f2);
      border: none;
      font-size: 18px;
      padding: 12px;
      font-weight: 600;
      border-radius: 12px;
      transition: all 0.3s ease;
    }

    .btn-primary:hover {
      background: linear-gradient(to right, #6610f2, #0d6efd);
      box-shadow: 0 5px 15px rgba(0, 123, 255, 0.3);
      transform: scale(1.02);
    }

    p[style*="color:red"] {
      font-size: 14px;
      margin-top: 5px;
      font-weight: 500;
      animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(15px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideIn {
      from {
        transform: translateX(-20px);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @media (max-width: 576px) {
      .form-container h2 {
        font-size: 22px;
      }

      .btn-primary {
        font-size: 16px;
      }
    }
  </style>
</head>

<body>

  <div class="container">
    <div class="form-container">
      <h2 class="text-center text-primary mb-4">ðŸ“„ Student Registration Form</h2>

      <% if(errors && errors.length> 0){ %>
        <div class="alert alert-danger">
          <ul>
            <% errors.forEach(e=> { %>
              <li>
                <%= e.msg %>
              </li>
              <% }) %>
          </ul>
        </div>
        <% } %>

          <form action="/students/register" method="POST">
            <div class="row g-3">
              <div class="col-md-6">
                <label for="studentName" class="form-label">Student Name</label>
                <input type="text" class="form-control" id="studentName" name="studentName" pattern="[A-Za-z\s.\-']+"
                  title="Only letters, spaces, dots (.), hyphens (-), and apostrophes (') are allowed" required
                  value="<%= formdata && formdata.studentName ? formdata.studentName : '' %>">
                <% if(errors && errors.length){ for(let i=0; i<errors.length; i++){ if(errors[i].param==='studentName'
                  ){ %>
                  <p style="color:red">
                    <%= errors[i].msg %>
                  </p>
                  <% break; }}} %>
              </div>

              <div class="col-md-6">
                <label for="fatherName" class="form-label">Father's Name</label>
                <input type="text" class="form-control" id="fatherName" name="fatherName" pattern="[A-Za-z\s.\-']+"
                  title="Only letters, spaces, dots (.), hyphens (-), and apostrophes (') are allowed" required
                  value="<%= formdata && formdata.fatherName ? formdata.fatherName : '' %>">
                <% if(errors && errors.length) { for(let i=0; i<errors.length; i++){ if(errors[i].param==='fatherName'
                  ){ %>
                  <p style="color:red;">
                    <%= errors[i].msg %>
                  </p>
                  <% break; }}} %>
              </div>
              <div class="col-md-6">
                <label for="motherName" class="form-label">Mother's Name</label>
                <input type="text" class="form-control" id="motherName" name="motherName" pattern="[A-Za-z\s.\-']+"
                  title="Only letters, spaces, dots (.), hyphens (-), and apostrophes (') are allowed" required
                  value="<%= formdata && formdata.motherName ? formdata.motherName : '' %>">
                <% if(errors && errors.length) { for(let i=0; i<errors.length; i++){ if(errors[i].param==='motherName'
                  ){ %>
                  <p style="color:red;">
                    <%= errors[i].msg %>
                  </p>
                  <% break; } }} %>
              </div>

              <div class="col-md-6">
                <label for="gender" class="form-label">Gender</label>
                <select class="form-select" id="gender" name="gender" required>
                  <option value="">Select Gender</option>
                  <option value="Male" <%=(formdata && formdata.gender==='Male' ) ? 'selected' : '' %>>Male</option>
                  <option value="Female" <%=(formdata && formdata.gender==='Female' ) ? 'selected' : '' %>>Female
                  </option>
                  <option value="Other" <%=(formdata && formdata.gender==='Other' ) ? 'selected' : '' %>>Other
                  </option>
                </select>
                <% if(errors && errors.length) { for(let i=0; i<errors.length; i++){ if(errors[i].param==='gender' ){ %>
                  <p style="color:red;">
                    <%= errors[i].msg %>
                  </p>
                  <% break; } }} %>
              </div>

              <div class="col-md-6">
                <label for="studentDob" class="form-label">Dob</label>
                <input type="date" class="form-control" id="studentDob" name="studentDob" required
                  value="<%= formdata && formdata.studentDob ? formdata.studentDob : '' %>">
                <% if(errors && errors.length) { for(let i=0; i<errors.length; i++){ if(errors[i].param==='studentDob'
                  ){ %>
                  <p style="color:red;">
                    <%= errors[i].msg %>
                  </p>
                  <% break; } }} %>
              </div>

              <div class="col-md-6">
                <label for="address" class="form-label">Address</label>
                <input type="text" class="form-control" id="address" name="address" required
                  value="<%= formdata && formdata.address ? formdata.address : '' %>">
                <% if(errors && errors.length) { for(let i=0; i<errors.length; i++){ if(errors[i].param==='address'
                  ){ %>
                  <p style="color:red;">
                    <%= errors[i].msg %>
                  </p>
                  <% break; } }} %>
              </div>

              <div class="col-md-6">
                <label for="studentClass" class="form-label">Class</label>
                <select class="form-select" id="studentClass" name="studentClass" required>
                  <option value="">Select Class</option>
                  <option value="Nursery" <%=(formdata && formdata.studentClass==='Nursery' ) ? 'selected' : '' %>
                    >Nursery</option>
                  <option value="LKG" <%=(formdata && formdata.studentClass==='LKG' ) ? 'selected' : '' %>>LKG
                  </option>
                  <option value="UKG" <%=(formdata && formdata.studentClass==='UKG' ) ? 'selected' : '' %>>UKG
                  </option>
                  <% for(let i=1; i <=10; i++) { %>
                    <option value="<%= i %>" <%=(formdata && formdata.studentClass==i) ? 'selected' : '' %>>
                      <%= i %>
                    </option>
                    <% } %>
                      <option value="11" <%=(formdata && formdata.studentClass=='11' ) ? 'selected' : '' %>>11
                      </option>
                      <option value="12" <%=(formdata && formdata.studentClass=='12' ) ? 'selected' : '' %>>12
                      </option>
                </select>
                <% if(errors && errors.length) { for(let i=0; i<errors.length; i++){ if(errors[i].param==='studentClass'
                  ){ %>
                  <p style="color:red;">
                    <%= errors[i].msg %>
                  </p>
                  <% break; } }} %>
              </div>

              <div class="col-md-6" id="streamSection">
                <label for="stream" class="form-label">Stream</label>
                <select class="form-select" id="stream" name="stream">
                  <option value="">Select Stream</option>
                  <option value="Arts" <%=(formdata && formdata.stream==='Arts' ) ? 'selected' : '' %>>Arts</option>
                  <option value="Science" <%=(formdata && formdata.stream==='Science' ) ? 'selected' : '' %>>Science
                  </option>
                  <option value="Commerce" <%=(formdata && formdata.stream==='Commerce' ) ? 'selected' : '' %>>Commerce
                  </option>
                </select>
                <% if(errors && errors.length) { for(let i=0; i<errors.length; i++){ if(errors[i].param==='stream' ){ %>
                  <p style="color:red;">
                    <%= errors[i].msg %>
                  </p>
                  <% break; } }} %>
              </div>

              <div class="col-md-6">
                <label for="medium" class="form-label">Medium</label>
                <select class="form-select" id="medium" name="medium" required>
                  <option value="">Select Medium</option>
                  <option value="Hindi" <%=(formdata && formdata.medium==='Hindi' ) ? 'selected' : '' %>>Hindi
                  </option>
                  <option value="English" <%=(formdata && formdata.medium==='English' ) ? 'selected' : '' %>>English
                  </option>
                </select>
                <% if(errors && errors.length) { for(let i=0; i<errors.length; i++){ if(errors[i].param==='medium' ){ %>
                  <p style="color:red;">
                    <%= errors[i].msg %>
                  </p>
                  <% break; } }} %>
              </div>

              <div class="col-md-6">
                <label for="contactNo" class="form-label">Contact Number</label>
                <input type="text" class="form-control" id="contactNo" name="contactNo" pattern="\d{10}" maxlength="10"
                  title="Enter exactly 10 digits" required
                  value="<%= formdata && formdata.contactNo ? formdata.contactNo : '' %>">
                <% if(errors && errors.length) { for(let i=0; i<errors.length; i++){ if(errors[i].param==='contactNo' ){
                  %>
                  <p style="color:red;">
                    <%= errors[i].msg %>
                  </p>
                  <% break; } }} %>
              </div>

              <div class="col-md-6">
                <label for="registrationNo" class="form-label">Registration Number</label>
                <input type="text" class="form-control" id="registrationNo" name="registrationNo" required
                  value="<%= formdata && formdata.registrationNo ? formdata.registrationNo : '' %>">
                <% if(errors && errors.length) { for(let i=0; i<errors.length; i++){
                  if(errors[i].param==='registrationNo' ){ %>
                  <p style="color:red;">
                    <%= errors[i].msg %>
                  </p>
                  <% break; } }} %>
              </div>
              <div class="col-md-6">
                <label for="totalFees" class="form-label">Total Fees (Annual)</label>
                <input type="number" class="form-control" id="totalFees" name="totalFees" required
                  value="<%= formdata && formdata.totalFees ? formdata.totalFees : '' %>">
                <% if(errors && errors.length) { for(let i=0; i<errors.length; i++){ if(errors[i].param==='totalFees' ){
                  %>
                  <p style="color:red;">
                    <%= errors[i].msg %>
                  </p>
                  <% break; } }} %>
              </div>

              <div class="col-md-6">
                <label for="feesPaid" class="form-label">Fees Paid</label>
                <input type="number" class="form-control" id="feesPaid" name="feesPaid" required
                  value="<%= formdata && formdata.feesPaid ? formdata.feesPaid : '' %>">
                <% if(errors && errors.length) { for(let i=0; i<errors.length; i++){ if(errors[i].param==='feesPaid' ){
                  %>
                  <p style="color:red;">
                    <%= errors[i].msg %>
                  </p>
                  <% break; } }} %>
              </div>
              <div class="row g-3" id="receiptDetails" style="display: none;">
               

                <div class="col-md-6">
                  <label for="date" class="form-label">Date</label>
                  <input type="datetime-local" class="form-control" id="date" name="date">
                </div>

                <div class="col-md-6">
                  <label for="paymentMethod" class="form-label">Payment Method</label>
                  <select class="form-select" id="paymentMethod" name="paymentMethod">
                    <option value="">-- Select Payment Method --</option>
                    <option value="Credit Card">Credit Card</option>
                    <option value="UPI">UPI</option>
                    <option value="Cash">Cash</option>
                    <option value="Cheque">Cheque</option>
                  </select>
                </div>
              </div>



              <div class="col-md-6">
                <label for="session" class="form-label">Session (e.g., 2025-26)</label>
                <input type="text" class="form-control" id="session" name="session" pattern="^\d{4}-\d{2}$"
                  title="Please use the format YYYY-YY (e.g., 2025-26)" required
                  value="<%= formdata && formdata.session ? formdata.session : '' %>">
                <% if(errors && errors.length) { for(let i=0; i<errors.length; i++){ if(errors[i].param==='session' ){
                  %>
                  <p style="color:red;">
                    <%= errors[i].msg %>
                  </p>
                  <% break; } }} %>
              </div>

            </div>

            <div class="d-grid mt-4 d-flex justify-content-between">
              <button type="submit" class="btn btn-primary btn-lg">Submit</button>
              <a href="/students/upload" class="btn btn-outline-secondary btn-lg ms-3">Upload Registration Files</a>
            </div>


          </form>
    </div>

       <div class="text-center mt-1">
                <a href="/" class="btn btn-outline-primary">â¬… Back to Dashboard</a>
              </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
    crossorigin="anonymous"></script>

  <script>
    document.querySelector('form').addEventListener('submit', function (e) {
      const textFields = ['studentName', 'fatherName', 'motherName'];
      let valid = true;
      let message = '';

      const regex = /^[A-Za-z\s.\-']+$/; // Updated regex to include dot, hyphen, apostrophe

      textFields.forEach(id => {
        const field = document.getElementById(id);
        const value = field.value.trim();

        if (!regex.test(value)) {
          valid = false;
          message += `Invalid input in ${id.replace(/([A-Z])/g, ' $1')}. Only letters, spaces, '.', '-', and apostrophes are allowed.\n`;
          field.style.border = '2px solid red';
        } else {
          field.style.border = '';
        }
      });

      // Session field validation
      const sessionField = document.getElementById('session');
      const sessionRegex = /^\d{4}-\d{2}$/;
      if (!sessionRegex.test(sessionField.value.trim())) {
        valid = false;
        message += 'Invalid session format. Please use YYYY-YY (e.g., 2025-26).\n';
        sessionField.style.border = '2px solid red';
      } else {
        sessionField.style.border = '';
      }


      if (!valid) {
        e.preventDefault(); // Prevent form submission
        alert(message);      // Show error message
      }
    });

    document.addEventListener('DOMContentLoaded', function () {
      const studentClassSelect = document.getElementById('studentClass');
      const streamSection = document.getElementById('streamSection');
      const streamSelect = document.getElementById('stream');

      function toggleStreamSection() {
        const selectedClass = studentClassSelect.value;
        if (selectedClass === '11' || selectedClass === '12') {
          streamSection.style.display = 'block';
          streamSelect.setAttribute('required', 'required'); // Make stream required when visible
        } else {
          streamSection.style.display = 'none';
          streamSelect.removeAttribute('required'); // Remove required when hidden
          streamSelect.value = ''; // Clear selection when hidden
        }
      }

      // Initial check on page load (useful if formdata pre-fills the class)
      toggleStreamSection();

      // Listen for changes in the class dropdown
      studentClassSelect.addEventListener('change', toggleStreamSection);

      const feesPaidInput = document.getElementById('feesPaid');
    const receiptDetails = document.getElementById('receiptDetails');
    const dateInput = document.getElementById('date');
    const paymentMethodSelect = document.getElementById('paymentMethod');

    function toggleReceiptFields() {
      const value = parseFloat(feesPaidInput.value);
      if (!isNaN(value) && value > 0) {
        receiptDetails.style.display ='block'; 
        dateInput.setAttribute('required', 'required');
        paymentMethodSelect.setAttribute('required', 'required');
      } else {
        receiptDetails.style.display = 'none';
        dateInput.removeAttribute('required');
        paymentMethodSelect.removeAttribute('required');
      }
    }

    // Trigger on page load in case form has prefilled data
    toggleReceiptFields();

    // Listen for input changes
    feesPaidInput.addEventListener('input', toggleReceiptFields);
    });

    const input = document.getElementById('studentName');

    // Block typing of numbers
    input.addEventListener('keypress', function (e) {
      if (/\d/.test(e.key)) {
        e.preventDefault();
      }
    });

    // Block pasting numbers
    input.addEventListener('paste', function (e) {
      const pastedText = (e.clipboardData || window.clipboardData).getData('text');
      if (/\d/.test(pastedText)) {
        e.preventDefault();
      }
    });

    // Block dropping numbers
    input.addEventListener('drop', function (e) {
      const data = e.dataTransfer.getData('text');
      if (/\d/.test(data)) {
        e.preventDefault();
      }
    });

    const fatherInput = document.getElementById('fatherName');

    // Block typing numbers
    fatherInput.addEventListener('keypress', function (e) {
      if (/\d/.test(e.key)) {
        e.preventDefault();
      }
    });

    // Block pasting numbers
    fatherInput.addEventListener('paste', function (e) {
      const pastedText = (e.clipboardData || window.clipboardData).getData('text');
      if (/\d/.test(pastedText)) {
        e.preventDefault();
      }
    });

    // Block dropping numbers
    fatherInput.addEventListener('drop', function (e) {
      const droppedText = e.dataTransfer.getData('text');
      if (/\d/.test(droppedText)) {
        e.preventDefault();
      }
    });

    const motherInput = document.getElementById('motherName');

    // Block typing numbers
    motherInput.addEventListener('keypress', function (e) {
      if (/\d/.test(e.key)) {
        e.preventDefault();
      }
    });

    // Block pasting numbers
    motherInput.addEventListener('paste', function (e) {
      const pastedText = (e.clipboardData || window.clipboardData).getData('text');
      if (/\d/.test(pastedText)) {
        e.preventDefault();
      }
    });

    // Block dropping numbers
    motherInput.addEventListener('drop', function (e) {
      const droppedText = e.dataTransfer.getData('text');
      if (/\d/.test(droppedText)) {
        e.preventDefault();
      }
    });

    const contactInput = document.getElementById('contactNo');

    // Allow only digits and limit to 10
    contactInput.addEventListener('input', function (e) {
      this.value = this.value.replace(/\D/g, ''); // Remove non-digits
      if (this.value.length > 10) {
        this.value = this.value.slice(0, 10); // Limit to 10 digits
      }
    });

    // Prevent pasting more than 10 digits
    contactInput.addEventListener('paste', function (e) {
      const pastedData = (e.clipboardData || window.clipboardData).getData('text');
      if (!/^\d{1,10}$/.test(pastedData)) {
        e.preventDefault();
      }
    });

   
    
  </script>

</body>

</html>