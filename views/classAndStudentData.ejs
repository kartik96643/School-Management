<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>All Classes</title>
  <style>
    /* Base styles */
    body.bg-light {
      background: linear-gradient(to bottom right, #e3f2fd, #f1f8e9);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #333;
      min-height: 100vh;
    }

    /* Heading styles */
    h2.text-primary {
      font-weight: 700;
      font-size: 2.5rem;
      position: relative;
    }

    h2.text-primary::after {
      content: '';
      width: 80px;
      height: 4px;
      background: #1976d2;
      display: block;
      margin: 12px auto 0;
      border-radius: 2px;
    }

    /* Section titles */
    .medium-section h3 {
      font-weight: 600;
      font-size: 1.7rem;
      color: #444;
      border-left: 6px solid #64b5f6;
      padding-left: 12px;
      margin-bottom: 1.5rem;
    }

    /* Card styles */
    .card {
      border: none;
      border-radius: 16px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      background: #fff;
    }

    .card:hover {
      transform: translateY(-6px);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
    }

    .card-title {
      font-size: 1.25rem;
      font-weight: 600;
    }

    .card-text {
      font-size: 1rem;
      color: #555;
    }

    /* Stream subtitle */
    .stream-card-title {
      font-weight: 500;
      color: #ff7043;
    }

    /* Button styles */
    .btn-outline-primary {
      border-radius: 30px;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .btn-outline-primary:hover {
      background-color: #1976d2;
      color: #fff;
      border-color: #1976d2;
    }

    /* Alert box */
    .alert-info {
      background-color: #e1f5fe;
      color: #0277bd;
      border: 1px solid #81d4fa;
      border-radius: 10px;
    }

    /* Back button */
    .text-center .btn-outline-primary {
      font-size: 1.1rem;
      padding: 10px 20px;
      margin-top: 30px;
    }

    /* Unauthorized message */
    .text-danger {
      font-size: 1.8rem;
      font-weight: bold;
    }

    /* Smooth card layout transition */
    .row.g-4 {
      animation: fadeUp 0.7s ease-in-out;
    }

    @keyframes fadeUp {
      from {
        opacity: 0;
        transform: translateY(40px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
</head>

<body class="bg-light">

  <% if (locals.user) { %>
    <%- include('navbar.ejs') %>

      <div class="container my-5">
        <h2 class="text-center text-primary mb-5">ðŸ“š All Classes </h2>
        <div class="mb-4 text-center">
  <input type="text" id="classSearch" class="form-control w-50 mx-auto" placeholder="ðŸ” Search for a class (e.g., 10, LKG, 12 - Science)">
</div>


        <% const mediums=['Hindi', 'English' ]; %>

          <% mediums.forEach(mediumName=> { %>
            <div class="medium-section">
              <h3 class="text-center text-secondary mb-4">
                <%= mediumName %> Medium Students
              </h3>
              <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
                <% const mediumData=(mediumName==='Hindi' ) ? data.hindiMedium : data.englishMedium; if (mediumData &&
                  mediumData.length> 0) {
                  mediumData.sort((a, b) => {
                  const classOrder = ['Nursery', 'LKG', 'UKG'];
                  const aIndex = classOrder.indexOf(a.studentClass);
                  const bIndex = classOrder.indexOf(b.studentClass);

                  if (aIndex > -1 && bIndex > -1) return aIndex - bIndex;
                  if (aIndex > -1) return -1;
                  if (bIndex > -1) return 1;

                  return parseInt(a.studentClass) - parseInt(b.studentClass);
                  });

                  // Process data to flatten streams into individual cards
                  const cardsToRender = [];
                  mediumData.forEach(classInfo => {
                  if (classInfo.studentClass === 'Passout') return; // ðŸš« Skip "Passout"

                  if (classInfo.studentClass === '11' || classInfo.studentClass === '12') {
                  if (classInfo.streams && classInfo.streams.length > 0) {
                  classInfo.streams.sort((a, b) => a.stream.localeCompare(b.stream)).forEach(streamData => {
                  cardsToRender.push({
                  studentClass: classInfo.studentClass,
                  stream: streamData.stream,
                  studentCount: streamData.studentCount,
                  isStreamClass: true
                  });
                  });
                  } else {
                  // If Class 11/12 with no stream data, still show a panel
                  cardsToRender.push({
                  studentClass: classInfo.studentClass,
                  stream: 'No Stream Data',
                  studentCount: 0,
                  isStreamClass: true
                  });
                  }
                  } else {
                  cardsToRender.push({
                  studentClass: classInfo.studentClass,
                  totalStudents: classInfo.totalStudents,
                  isStreamClass: false,

                  });
                  }
                  });
                  %>
                  <% cardsToRender.forEach(info=> { %>
                   <div class="col class-card" data-class="<%= info.studentClass.toLowerCase() %> <%= info.stream ? info.stream.toLowerCase() : '' %>">
  <div class="card shadow-sm h-100">

                        <div class="card-body d-flex flex-column justify-content-between">
                          <div>
                            <% if (info.isStreamClass) { %>
                              <h5 class="card-title text-primary">Class <%= info.studentClass %> - <span
                                    class="stream-card-title">
                                    <%= info.stream %>
                                  </span></h5>
                              <p class="card-text text-muted">Total Students: <strong>
                                  <%= info.studentCount %>
                                </strong></p>
                              <% } else { %>
                                <h5 class="card-title text-primary">Class <%= info.studentClass %>
                                </h5>
                                <p class="card-text text-muted">Total Students: <strong>
                                    <%= info.totalStudents %>
                                  </strong></p>
                                <% } %>
                          </div>
                          <% let
                            detailLink=`/students/classes/${info.studentClass}?medium=${encodeURIComponent(mediumName)}`;
                            if (info.isStreamClass && info.stream !=='No Stream Data' ) { detailLink
                            +=`&stream=${encodeURIComponent(info.stream)}`; } %>
                            <a href="<%= detailLink %>" class="btn btn-outline-primary mt-auto my-1 ">View Details</a>
                            <a href="/students/edit-total-fees?<%= 
  `medium=${encodeURIComponent(mediumName)}&studentClass=${info.studentClass}${info.isStreamClass ? `&stream=${encodeURIComponent(info.stream)}` : ''}`
%>" class="btn btn-outline-primary mt-auto">
                              Update Total Fee
                            </a>

                        </div>
                      </div>
                    </div>
                    <% }) %>
                      <% } else { %>
                        <div class="col-12">
                          <div class="alert alert-info text-center" role="alert">
                            No <%= mediumName %> Medium class data available.
                          </div>
                        </div>
                        <% } %>
              </div>
            </div>
            <% }) %>

              <div class="text-center mt-5">
                <a href="/" class="btn btn-outline-primary">â¬… Back to Dashboard</a>
              </div>
      </div>
      <% } else { %>
        <div class="container d-flex justify-content-center align-items-center" style="height: 80vh;">
          <div class="text-center">
            <h2 class="text-danger">ðŸš« You are not authorized to view this page.</h2>
            <a href="/login" class="btn btn-primary mt-3">Go to Login</a>
          </div>
        </div>
        <% } %>

          <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
            crossorigin="anonymous"></script>
            <script>
  const searchInput = document.getElementById('classSearch');

  searchInput.addEventListener('input', () => {
    const filter = searchInput.value.toLowerCase();
    const cards = document.querySelectorAll('.class-card');

    cards.forEach(card => {
      const classInfo = card.getAttribute('data-class');
      if (classInfo.includes(filter)) {
        card.style.display = '';
      } else {
        card.style.display = 'none';
      }
    });
  });
</script>


</body>

</html>